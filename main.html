<!doctype html>
<html>
  <head>
    <script type="text/javascript" src="https://www.fofx.co/comp/comp.js"></script>
    <script type="text/javascript" src="https://restonlimousine.github.io/staff/xlsx.js"></script>
  </head>
  <body>
    <div><input type="file" id="upload-santa-cruz"></div>
    <div><input type="file" id="upload-samsara"></div>
    <script type="text/plain" data-comp-src="https://raw.githubusercontent.com/fofx-software/comp/master/comp/comp/core.cmp.clj">
      {:ns main
       :require [[element.core :as el :src "https://raw.githubusercontent.com/fofx-software/element/master/core.cmp.clj"]]}
      
      (def reader (new js/FileReader))

      (.addEventListener reader "loadend"
        (fn []
          (let [result (new js/Uint8Array (.-result reader))
                book (.read js/XLSX result (object "type" "array"))
                first-sheet (-> book .-SheetNames (aget 0))
                sheet (-> book .-Sheets (aget first-sheet))]
            (-> js/XLSX .-utils (.sheet_to_json sheet)))))
      
      (doseq [id ["upload-samsara" "upload-santa-cruz"]]
        (let [input (.getElementById js/document id)]
          (.addEventListener input "change"
            (fn [e]
              (.readAsArrayBuffer reader (aget (.-files input) 0))))))
      
      (comp/pr "done")
    </script>
  </body>
</html>
